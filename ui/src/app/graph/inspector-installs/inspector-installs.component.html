<div class="edge-container">
  <div class="heading">
    <h3>Details</h3>

    <button
      mat-icon-button
      [disabled]="isFirst()"
      (click)="navigate(-1)"
      matTooltip="Previous"
      aria-label="Previous Deploy">
      <mat-icon>navigate_before</mat-icon>
    </button>

    <button
      mat-icon-button
      [disabled]="isLast()"
      (click)="navigate(1)"
      matTooltip="Next"
      aria-label="Next Deploy">
      <mat-icon>navigate_next</mat-icon>
    </button>

    @let curr = current();
    @if (curr && curr.intention) {
      <button
        mat-icon-button
        [matMenuTriggerFor]="menu"><mat-icon>more_vert</mat-icon></button>
      <mat-menu #menu="matMenu">
        @if (curr && curr.intention) {
          <button mat-menu-item (click)="viewIntention(curr.intention)">View Intention</button>
        }
        @if (curr && curr.source?.action.source?.intention) {
          <button mat-menu-item (curr)="viewIntention(curr.source.action.source.intention)">View Build</button>
        }
        @if (curr && curr.source?.action.package?.id) {
          <button mat-menu-item (click)="openServicePackage(curr.source.action.service.id, curr.source.action.package.id)">View Package</button>
        }
        <mat-divider></mat-divider>
        @if (curr && curr.source?.intention?.event.url) {
          <a
            mat-menu-item
            matTooltip="Access to this content may be restricted"
            matTooltipPosition="left"
            matTooltipShowDelay="500"
            href="{{curr.source.intention.event.url}}"
            target="_blank">View Event</a>
        }
        @if (curr && curr.source?.intention?.auditUrl) {
          <a
            mat-menu-item
            href="{{curr.source.intention.auditUrl}}"
            target="_blank">View Audit</a>
        }
      </mat-menu>
    }
  </div>
</div>
@if (pointers()) {
  @if (!curr || !curr.source?.intention) {
    <div class="edge-container edge-container-margin-left">No recorded installation</div>
  }
  @if (curr && curr.source?.intention) {
    <div class="edge-container edge-container-margin-left install-details">
      <div class="install-version">
        <app-outcome-icon
          [outcome]="curr.source.intention.transaction.outcome"></app-outcome-icon>

          @if (curr.source?.action?.package?.version) {
            {{curr.source.action.package.version}}
          }
      </div>

      <app-details-item item="Installed">{{curr.source.intention.transaction.start | date:'short'}}</app-details-item>

      <app-details-item
        (click)="openUserInBrowserByGuid(curr.source.intention.user.id)"
        item="User"
        clickable="true">{{curr.source.intention.user.name}}</app-details-item>

    </div>
  }
}
